<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Continuous Performance Test (CPT-II)</title>
    <style>
        /* ESTILOS GENERALES */
        body {
            font-family: 'Verdana', sans-serif;
            margin: 0;
            padding: 0;
            background-color: black;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* TÍTULO PRINCIPAL */
        #main-title {
            margin-bottom: 20px 0 30px 0;
            font-size: 28px;
            color: white;
        }

        /* PANTALLA DEMOGRÁFICA */
        #demographics-container {
            margin: 20px auto;
            background-color: white;
            color: black;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        /* FORMULARIO DEMOGRÁFICO */
        #demographics-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: left;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: bold;
            font-size: 16px;
            color: #333;
        }

        .form-group input, 
        .form-group select {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            color: #333;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            display: none;
        }

        /* BOTONES */
        button {
            padding: 12px 24px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        /* PANTALLAS */
        #start-screen, #instructions-screen, #end-screen {
            max-width: 800px;
            padding: 20px;
            display: none;
        }

        /* PANTALLA DE PRUEBA */
        #test-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        #stimulus {
            font-size: 72px;
            margin: 40px 0;
            color: white;
        }

        #feedback {
            font-size: 48px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .correct {
            color: green;
        }

        .incorrect {
            color: red;
        }
    </style>
</head>
<body>
    <!-- Título principal (fuera del formulario) -->
    <h1 id="main-title">Continuous Performance Test (CPT-II)</h1>

    <!-- Contenedor de datos demográficos -->
    <div id="demographics-container">
        <form id="demographics-form">
            <div class="form-group">
                <label for="age">Edad:</label>
                <input type="number" id="age" min="1" max="120" required>
                <div id="age-error" class="error-message">Por favor ingresa una edad válida (1-120)</div>
            </div>

            <div class="form-group">
                <label for="gender">Género:</label>
                <select id="gender" required>
                    <option value="">Selecciona tu género</option>
                    <option value="1">Mujer</option>
                    <option value="2">Varón</option>
                    <option value="88">Otro</option>
                    <option value="99">Prefiero no decirlo</option>
                </select>
                <div id="gender-error" class="error-message">Por favor selecciona una opción</div>
            </div>

            <div class="form-group">
                <label for="education">Nivel educativo:</label>
                <select id="education" required>
                    <option value="">Selecciona tu nivel educativo</option>
                    <option value="0">Sin estudios</option>
                    <option value="1">Educación Primaria</option>
                    <option value="2">Educación Secundaria</option>
                    <option value="3">Educación Superior</option>
                </select>
                <div id="education-error" class="error-message">Por favor selecciona una opción</div>
            </div>

            <button type="button" id="submit-demographics">Continuar</button>
        </form>
    </div>

    <!-- Pantalla de inicio -->
    <div id="start-screen">
        <h1>Continuous Performance Test (CPT-II)</h1>
        <p>Esta prueba evalúa la atención sostenida y el control de impulsos.</p>
        <button id="start-btn">Comenzar</button>
    </div>

    <!-- Pantalla de instrucciones -->
    <div id="instructions-screen">
        <h2>Instrucciones</h2>
        <p>Se te presentarán letras una por una en la pantalla.</p>
        <p>Presiona la BARRA ESPACIADORA cada vez que veas una letra, EXCEPTO cuando veas la letra "X".</p>
        <p>Las letras aparecerán rápidamente, así que mantén tu atención en la pantalla.</p>
        <p>La prueba durará aproximadamente 14 minutos.</p>
        <button id="begin-test-btn">Entendido, comenzar prueba</button>
    </div>

    <!-- Pantalla de prueba -->
    <div id="test-screen">
        <div id="stimulus"></div>
        <div id="feedback"></div>
    </div>

    <!-- Pantalla de finalización -->
    <div id="end-screen">
        <h2>Prueba completada</h2>
        <p id="results-summary"></p>
        <p>Gracias por participar.</p>
        <button id="download-btn">Descargar resultados</button>
    </div>

    <script>
        // Configuración de la prueba (basada en el script PEBL original)
        const config = {
            cycles: 6,
            blocksize: 20,
            prestime: 250,
            targprob: 0.1,
            isiVals: [1000, 2000, 4000],
            letters: ["A","B","C","D","E","F","G","H","I","J","L","M","O","P","Q","R","S","U"],
            giveFeedback: false
        };

        // Variables de estado
        let currentTrial = 0;
        let totalTrials = 20; // Para pruebas. Cambiar a config.cycles * config.blocksize * config.isiVals.length para la versión final.
        let isiSequence = [];
        let blockStimuli = [];
        let testData = [];
        let startTime;
        let currentISI;
        let testStartTime;
        let responseRegistered = false;
        let participantCode = "P" + Math.floor(Math.random() * 10000);
        let currentStimulus = '';
        let demographics = { age: null, gender: null, education: null };

        // Elementos de la interfaz
        const ui = {
            mainTitle: document.getElementById('main-title'),
            demographicsContainer: document.getElementById('demographics-container'),
            startScreen: document.getElementById('start-screen'),
            instructionsScreen: document.getElementById('instructions-screen'),
            testScreen: document.getElementById('test-screen'),
            endScreen: document.getElementById('end-screen'),
            startBtn: document.getElementById('start-btn'),
            beginTestBtn: document.getElementById('begin-test-btn'),
            downloadBtn: document.getElementById('download-btn'),
            stimulus: document.getElementById('stimulus'),
            feedback: document.getElementById('feedback'),
            resultsSummary: document.getElementById('results-summary'),
            demographicsForm: document.getElementById('demographics-form'),
            submitDemographicsBtn: document.getElementById('submit-demographics'),
            ageInput: document.getElementById('age'),
            genderSelect: document.getElementById('gender'),
            educationSelect: document.getElementById('education'),
            ageError: document.getElementById('age-error'),
            genderError: document.getElementById('gender-error'),
            educationError: document.getElementById('education-error')
        };

        // Event listeners
        ui.submitDemographicsBtn.addEventListener('click', validateDemographics);
        ui.startBtn.addEventListener('click', showInstructions);
        ui.beginTestBtn.addEventListener('click', startTest);
        ui.downloadBtn.addEventListener('click', downloadResults);

        // --- FLUJO DE LA APLICACIÓN ---

        function validateDemographics() {
            let isValid = true;
            const age = parseInt(ui.ageInput.value);
            if (isNaN(age) || age < 1 || age > 120) {
                ui.ageError.style.display = 'block';
                isValid = false;
            } else {
                ui.ageError.style.display = 'none';
                demographics.age = age;
            }
            if (!ui.genderSelect.value) {
                ui.genderError.style.display = 'block';
                isValid = false;
            } else {
                ui.genderError.style.display = 'none';
                demographics.gender = ui.genderSelect.options[ui.genderSelect.selectedIndex].text;
            }
            if (!ui.educationSelect.value) {
                ui.educationError.style.display = 'block';
                isValid = false;
            } else {
                ui.educationError.style.display = 'none';
                demographics.education = ui.educationSelect.options[ui.educationSelect.selectedIndex].text;
            }
            if (isValid) {
                ui.mainTitle.style.display = 'none';
                ui.demographicsContainer.style.display = 'none';
                ui.startScreen.style.display = 'block';
            }
        }

        function showInstructions() {
            ui.startScreen.style.display = 'none';
            ui.instructionsScreen.style.display = 'block';
        }

        function startTest() {
            ui.instructionsScreen.style.display = 'none';
            ui.testScreen.style.display = 'flex';
            openFullscreen(document.documentElement);
            testStartTime = Date.now();
            isiSequence = [];
            for (let i = 0; i < config.cycles; i++) {
                isiSequence = isiSequence.concat(shuffleArray([...config.isiVals]));
            }
            document.addEventListener('keydown', handleKeyPress);
            runTrial();
        }

        function runTrial() {
            responseRegistered = false;
            if (currentTrial % config.blocksize === 0) {
                const blockIndex = Math.floor(currentTrial / config.blocksize);
                currentISI = isiSequence[blockIndex];
                const targetCount = Math.round(config.blocksize * config.targprob);
                const nonTargetCount = config.blocksize - targetCount;
                let stimuli = Array(targetCount).fill('X').concat(getRandomLetters(nonTargetCount));
                blockStimuli = shuffleArray(stimuli);
            }
            currentStimulus = blockStimuli[currentTrial % config.blocksize];
            ui.stimulus.textContent = currentStimulus;
            startTime = Date.now();
            setTimeout(() => {
                ui.stimulus.textContent = '';
                setTimeout(() => {
                    if (!responseRegistered) {
                        const isCorrect = (currentStimulus === 'X');
                        testData.push({
                            sub: participantCode,
                            block: Math.floor(currentTrial / config.blocksize) + 1,
                            trial: currentTrial + 1,
                            cond: currentISI,
                            targ: currentStimulus,
                            responded: 0,
                            corr: isCorrect ? 1 : 0,
                            time: startTime - testStartTime,
                            rt: -1
                        });
                    }
                    currentTrial++;
                    if (currentTrial < totalTrials) {
                        runTrial();
                    } else {
                        endTest();
                    }
                }, currentISI - config.prestime);
            }, config.prestime);
        }

        function handleKeyPress(event) {
            if (event.code === 'Space' && !responseRegistered) {
                responseRegistered = true;
                const reactionTime = Date.now() - startTime;
                const isCorrect = (currentStimulus !== 'X');
                testData.push({
                    sub: participantCode,
                    block: Math.floor(currentTrial / config.blocksize) + 1,
                    trial: currentTrial + 1,
                    cond: currentISI,
                    targ: currentStimulus,
                    responded: 1,
                    corr: isCorrect ? 1 : 0,
                    time: startTime - testStartTime,
                    rt: reactionTime
                });
                if (config.giveFeedback) {
                    showFeedback(isCorrect);
                }
                ui.stimulus.textContent = '';
            }
        }

        function endTest() {
            closeFullscreen();
            document.removeEventListener('keydown', handleKeyPress);
            ui.testScreen.style.display = 'none';
            const results = calculateResults();
            sendDataToGoogleSheet(demographics, results);
            displayResults(results);
            ui.endScreen.style.display = 'block';
        }

        // --- FUNCIONES DE DATOS Y RESULTADOS ---

        async function sendDataToGoogleSheet(demographicsData, resultsData) {
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby5X5Fg0wkuQ8V1ita7mt6NNFHT-JE5s5M1PHTqgVmsGYmJVZfd0kSEssI-DV9zsjYq/exec';
            const allRTs = [...resultsData.stats[1000].rtCorr, ...resultsData.stats[2000].rtCorr, ...resultsData.stats[4000].rtCorr];
            const pooledMeanRT = calculateMean(allRTs);
            const pooledSdRT = calculateSD(allRTs);
            const hitRate = resultsData.totalCorrectTargets / resultsData.totalTargets;
            const faRate = resultsData.totalCommissionErrors / resultsData.totalFoils;
            const pHit = Math.max(0.01, Math.min(0.99, hitRate));
            const pFA = Math.max(0.01, Math.min(0.99, faRate));
            const zHit = inverseNormalCDF(pHit);
            const zFA = inverseNormalCDF(pFA);
            const pooledDPrime = zHit - zFA;
            const pooledBeta = Math.exp((zFA * zFA - zHit * zHit) / 2);
            const finalData = {
                'Timestamp': new Date().toISOString(),
                'ID': participantCode,
                'Age': demographicsData.age,
                'Gender': demographicsData.gender,
                'Education': demographicsData.education,
                'Correct_Trials_1000': `${resultsData.stats[1000].correctTrials}/${resultsData.trialsPerCond}`,
                'Correct_Trials_2000': `${resultsData.stats[2000].correctTrials}/${resultsData.trialsPerCond}`,
                'Correct_Trials_4000': `${resultsData.stats[4000].correctTrials}/${resultsData.trialsPerCond}`,
                'Correct_Trials_Pooled': `${resultsData.totalCorrectTrials}/${resultsData.totalTrials}`,
                'Correct_Targets_1000': `${resultsData.stats[1000].correctTargets}/${resultsData.stats[1000].targets}`,
                'Correct_Targets_2000': `${resultsData.stats[2000].correctTargets}/${resultsData.stats[2000].targets}`,
                'Correct_Targets_4000': `${resultsData.stats[4000].correctTargets}/${resultsData.stats[4000].targets}`,
                'Correct_Targets_Pooled': `${resultsData.totalCorrectTargets}/${resultsData.totalTargets}`,
                'Correct_Foils_1000': `${resultsData.stats[1000].correctFoils}/${resultsData.stats[1000].foils}`,
                'Correct_Foils_2000': `${resultsData.stats[2000].correctFoils}/${resultsData.stats[2000].foils}`,
                'Correct_Foils_4000': `${resultsData.stats[4000].correctFoils}/${resultsData.stats[4000].foils}`,
                'Correct_Foils_Pooled': `${resultsData.totalCorrectFoils}/${resultsData.totalFoils}`,
                'Target_Acc_Rate_1000': resultsData.stats[1000].targetAccRate.toFixed(3),
                'Target_Acc_Rate_2000': resultsData.stats[2000].targetAccRate.toFixed(3),
                'Target_Acc_Rate_4000': resultsData.stats[4000].targetAccRate.toFixed(3),
                'Target_Acc_Rate_Pooled': (resultsData.totalCorrectTargets / resultsData.totalTargets).toFixed(3),
                'Foil_Acc_Rate_1000': resultsData.stats[1000].foilAccRate.toFixed(3),
                'Foil_Acc_Rate_2000': resultsData.stats[2000].foilAccRate.toFixed(3),
                'Foil_Acc_Rate_4000': resultsData.stats[4000].foilAccRate.toFixed(3),
                'Foil_Acc_Rate_Pooled': (resultsData.totalCorrectFoils / resultsData.totalFoils).toFixed(3),
                'Commissions_1000': resultsData.stats[1000].commissionErrors,
                'Commissions_2000': resultsData.stats[2000].commissionErrors,
                'Commissions_4000': resultsData.stats[4000].commissionErrors,
                'Commissions_Pooled': resultsData.totalCommissionErrors,
                'Omissions_1000': resultsData.stats[1000].omissionErrors,
                'Omissions_2000': resultsData.stats[2000].omissionErrors,
                'Omissions_4000': resultsData.stats[4000].omissionErrors,
                'Omissions_Pooled': resultsData.totalOmissionErrors,
                'Mean_RT_1000': resultsData.stats[1000].meanRT.toFixed(2),
                'Mean_RT_2000': resultsData.stats[2000].meanRT.toFixed(2),
                'Mean_RT_4000': resultsData.stats[4000].meanRT.toFixed(2),
                'Mean_RT_Pooled': pooledMeanRT.toFixed(2),
                'SD_RT_1000': resultsData.stats[1000].sdRT.toFixed(2),
                'SD_RT_2000': resultsData.stats[2000].sdRT.toFixed(2),
                'SD_RT_4000': resultsData.stats[4000].sdRT.toFixed(2),
                'SD_RT_Pooled': pooledSdRT.toFixed(2),
                'd_prime_1000': resultsData.stats[1000].dPrime.toFixed(3),
                'd_prime_2000': resultsData.stats[2000].dPrime.toFixed(3),
                'd_prime_4000': resultsData.stats[4000].dPrime.toFixed(3),
                'd_prime_Pooled': pooledDPrime.toFixed(3),
                'Beta_1000': resultsData.stats[1000].beta.toFixed(3),
                'Beta_2000': resultsData.stats[2000].beta.toFixed(3),
                'Beta_4000': resultsData.stats[4000].beta.toFixed(3),
                'Beta_Pooled': pooledBeta.toFixed(3)
            };
            try {
                const formData = new FormData();
                formData.append('jsonData', JSON.stringify(finalData));
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                });
                const result = await response.json();
                console.log('Resumen completo enviado a Google Apps Script con éxito:', result);
            } catch (error) {
                console.error('Error al enviar el resumen completo a Google Apps Script:', error);
            }
        }

        function calculateResults() {
            const results = {
                trialsPerCond: config.cycles * config.blocksize,
                totalTrials: totalTrials,
                stats: {
                    1000: calculateConditionStats(1000),
                    2000: calculateConditionStats(2000),
                    4000: calculateConditionStats(4000)
                }
            };
            results.totalCorrectTrials = results.stats[1000].correctTrials + results.stats[2000].correctTrials + results.stats[4000].correctTrials;
            results.totalCorrectTargets = results.stats[1000].correctTargets + results.stats[2000].correctTargets + results.stats[4000].correctTargets;
            results.totalCorrectFoils = results.stats[1000].correctFoils + results.stats[2000].correctFoils + results.stats[4000].correctFoils;
            results.totalTargets = results.stats[1000].targets + results.stats[2000].targets + results.stats[4000].targets;
            results.totalFoils = results.stats[1000].foils + results.stats[2000].foils + results.stats[4000].foils;
            results.totalCommissionErrors = results.stats[1000].commissionErrors + results.stats[2000].commissionErrors + results.stats[4000].commissionErrors;
            results.totalOmissionErrors = results.stats[1000].omissionErrors + results.stats[2000].omissionErrors + results.stats[4000].omissionErrors;
            return results;
        }

        function calculateConditionStats(isi) {
            const trials = testData.filter(trial => trial.cond === isi);
            const targets = trials.filter(trial => trial.targ !== 'X');
            const foils = trials.filter(trial => trial.targ === 'X');
            const correctTrials = trials.filter(trial => trial.corr === 1).length;
            const correctTargets = targets.filter(trial => trial.responded === 1).length;
            const correctFoils = foils.filter(trial => trial.responded === 0).length;
            const commissionErrors = foils.filter(trial => trial.responded === 1).length;
            const omissionErrors = targets.filter(trial => trial.responded === 0).length;
            const targetAccRate = targets.length > 0 ? correctTargets / targets.length : 0;
            const foilAccRate = foils.length > 0 ? correctFoils / foils.length : 0;
            const rtCorr = targets.filter(trial => trial.responded === 1 && trial.rt > 0).map(trial => trial.rt);
            const rtInc = foils.filter(trial => trial.responded === 1 && trial.rt > 0).map(trial => trial.rt);
            const meanRT = rtCorr.length > 0 ? calculateMean(rtCorr) : 0;
            const sdRT = rtCorr.length > 0 ? calculateSD(rtCorr) : 0;
            const pHit = Math.max(0.01, Math.min(0.99, targetAccRate));
            const pFA = 1 - Math.max(0.01, Math.min(0.99, foilAccRate));
            const zHit = inverseNormalCDF(pHit);
            const zFA = inverseNormalCDF(pFA);
            const dPrime = zHit - zFA;
            const beta = normalPDF(zHit) / normalPDF(zFA);
            return { correctTrials, correctTargets, correctFoils, targets: targets.length, foils: foils.length, omissionErrors, commissionErrors, targetAccRate, foilAccRate, meanRT, sdRT, dPrime, beta, rtCorr, rtInc };
        }

        function displayResults(results) {
            let summary = `<p>Precisión general: ${results.totalTrials > 0 ? Math.round(results.totalCorrectTrials / results.totalTrials * 100) : 0}%</p>
                           <p>Errores de omisión (no presionar para letras): ${results.totalOmissionErrors}</p>
                           <p>Errores de comisión (presionar para X): ${results.totalCommissionErrors}</p>`;
            ui.resultsSummary.innerHTML = summary;
        }

        function downloadResults() {
            let csvContent = "ID,Age,Gender,Education,Block,Trial,ISI,Stimulus,Responded,Correct,Time,RT\n";
            testData.forEach(trial => {
                csvContent += `${participantCode},${demographics.age},${demographics.gender},${demographics.education},${trial.block},${trial.trial},${trial.cond},${trial.targ},${trial.responded},${trial.corr},${trial.time},${trial.rt}\n`;
            });
            const results = calculateResults();
            csvContent += "\n\nREPORT SUMMARY\n";
            csvContent += `Statistic,ISI 1000,ISI 2000,ISI 4000,Pooled\n`;
            csvContent += `Correct Trials,${results.stats[1000].correctTrials}/${results.trialsPerCond},${results.stats[2000].correctTrials}/${results.trialsPerCond},${results.stats[4000].correctTrials}/${results.trialsPerCond},${results.totalCorrectTrials}/${results.totalTrials}\n`;
            // ... (resto de la generación del CSV)
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `CPT_Results_${participantCode}_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- FUNCIONES AUXILIARES ---

        function showFeedback(isCorrect) {
            ui.feedback.textContent = isCorrect ? '+' : '-';
            ui.feedback.className = isCorrect ? 'correct' : 'incorrect';
            ui.feedback.style.display = 'block';
            setTimeout(() => { ui.feedback.style.display = 'none'; }, 50);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getRandomLetters(count) {
            const letters = [];
            for (let i = 0; i < count; i++) {
                letters.push(config.letters[Math.floor(Math.random() * config.letters.length)]);
            }
            return letters;
        }

        function calculateMean(array) {
            if (!array || array.length === 0) return 0;
            return array.reduce((a, b) => a + b, 0) / array.length;
        }

        function calculateSD(array) {
            if (!array || array.length < 2) return 0;
            const mean = calculateMean(array);
            const squaredDiffs = array.map(value => Math.pow(value - mean, 2));
            return Math.sqrt(calculateMean(squaredDiffs));
        }

        function openFullscreen(elem) {
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.mozRequestFullScreen) { /* Firefox */
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE/Edge */
                elem.msRequestFullscreen();
            }
        }

        function closeFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) { /* Firefox */
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE/Edge */
                document.msExitFullscreen();
            }
        }

        function inverseNormalCDF(p) {
            const a1 = -39.6968302866538, a2 = 220.946098424521, a3 = -275.928510446969, a4 = 138.357751867269, a5 = -30.6647980661472, a6 = 2.50662827745924;
            const b1 = -54.4760987982241, b2 = 161.585836858041, b3 = -155.698979859887, b4 = 66.8013118877197, b5 = -13.2806815528857;
            const c1 = -7.78489400243029E-03, c2 = -0.322396458041136, c3 = -2.40075827716184, c4 = -2.54973253934373, c5 = 4.37466414146497, c6 = 2.93816398269878;
            const d1 = 7.78469570904146E-03, d2 = 0.32246712907004, d3 = 2.445134137143, d4 = 3.75440866190742;
            const p_low = 0.02425, p_high = 1 - p_low;
            let q, r;
            if (p < p_low) {
                q = Math.sqrt(-2 * Math.log(p));
                return (((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) / ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
            } else if (p <= p_high) {
                q = p - 0.5;
                r = q * q;
                return (((((a1 * r + a2) * r + a3) * r + a4) * r + a5) * r + a6) * q / (((((b1 * r + b2) * r + b3) * r + b4) * r + b5) * r + 1);
            } else {
                q = Math.sqrt(-2 * Math.log(1 - p));
                return -(((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) / ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
            }
        }

        function normalPDF(x) {
            return Math.exp(-x * x / 2) / Math.sqrt(2 * Math.PI);
        }
    </script>
</body>

</html>

